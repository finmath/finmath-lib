<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.9.2 from src/site/markdown/migration/4.0.x-to-5.0.1.md at 2025-10-09
 | Rendered using Apache Maven Fluido Skin 1.9
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.9.2" />
    <title>finmath lib &#x2013; Migrating a project referencing finmath-lib from 4.0.x or 4.1.x to 5.0.0 (or higher).</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.9.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script src="../js/apache-maven-fluido-1.9.min.js"></script>
  </head>
  <body class="topBarEnabled">
    <header id="topbar" class="navbar navbar-fixed-top ">
      <div class="navbar-inner">
        <div class="container-fluid">
        <a data-target=".nav-collapse" data-toggle="collapse" class="btn btn-navbar">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
            <ul class="nav">
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">finmath lib <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../index.html" title="Introduction">Introduction</a></li>
            <li><a href="../apidocs" title="API Documentation">API Documentation</a></li>
            <li><a href="../gettingstarted.html" title="Getting Started">Getting Started</a></li>
            <li class="dropdown-submenu">
<a href="../building.html" title="Building from Source">Building from Source</a>
              <ul class="dropdown-menu">
                  <li><a href="../maven.html" title="Maven Build">Maven Build</a></li>
                  <li><a href="../eclipseproject.html" title="Eclipse Project">Eclipse Project</a></li>
              </ul>
            </li>
            <li><a href="https://github.com/finmath/finmath-lib/releases" title="Releases">Releases</a></li>
            <li><a href="../releasenotes.html" title="Release Notes">Release Notes</a></li>
            <li><a href="../codingconventions.html" title="Coding Conventions">Coding Conventions</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Concepts <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../concepts/stochasticautomaticdifferentiation" title="Stochastic Automatic Differentiation">Stochastic Automatic Differentiation</a></li>
            <li><a href="../concepts/automatictrackingofmeasurability" title="Automatic Tracking of Measurability">Automatic Tracking of Measurability</a></li>
            <li class="dropdown-submenu">
<a href="../concepts/separationofproductandmodel" title="Separation of Product and Model and Numerical Method">Separation of Product and Model and Numerical Method</a>
              <ul class="dropdown-menu">
                  <li><a href="../concepts/separationofproductandmodel/modelandproductinterfaces.html" title="Model and Product Interfaces">Model and Product Interfaces</a></li>
                  <li><a href="../concepts/separationofproductandmodel/modelandproductdescriptors.html" title="Model and Product Descriptors">Model and Product Descriptors</a></li>
              </ul>
            </li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Usages <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li><a href="../../finmath-experiments" title="Experiments">Experiments</a></li>
            <li><a href="../../finmath-spreadsheets/" title="Spreadsheets">Spreadsheets</a></li>
            <li><a href="../../topics/" title="Special Topics">Special Topics</a></li>
            <li><a href="http://christian-fries.de/finmath/applets/" title="Applets">Applets</a></li>
        </ul>
      </li>
      <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Documentation <b class="caret"></b></a>
        <ul class="dropdown-menu">
            <li class="dropdown-submenu">
<a href="../project-info.html" title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                  <li><a href="../summary.html" title="Summary">Summary</a></li>
                  <li><a href="../scm.html" title="Source Code Management">Source Code Management</a></li>
                  <li><a href="../distribution-management.html" title="Distribution Management">Distribution Management</a></li>
                  <li><a href="../dependency-info.html" title="Dependency Information">Dependency Information</a></li>
                  <li><a href="../dependencies.html" title="Dependencies">Dependencies</a></li>
                  <li><a href="../issue-management.html" title="Issue Management">Issue Management</a></li>
                  <li><a href="../ci-management.html" title="CI Management">CI Management</a></li>
                  <li><a href="../licenses.html" title="Licenses">Licenses</a></li>
                  <li><a href="../team.html" title="Team">Team</a></li>
              </ul>
            </li>
            <li class="dropdown-submenu">
<a href="../project-reports.html" title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                  <li><a href="../apidocs/index.html" title="Javadoc">Javadoc</a></li>
                  <li><a href="../surefire-report.html" title="Surefire Report">Surefire Report</a></li>
                  <li><a href="../checkstyle.html" title="Checkstyle">Checkstyle</a></li>
              </ul>
            </li>
        </ul>
      </li>
            </ul>
            <ul class="nav pull-right">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">External Links <b class="caret"></b></a>
                <ul class="dropdown-menu">
    <li><a href="../../" title="finmath.net">finmath.net</a></li>
                </ul>
              </li>
            </ul>
        </div>
      </div>
    </header>
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><a href=".././" id="bannerLeft"><h2>finmath lib</h2>
</a></div>
          <div class="pull-right"><a href="../.." id="bannerRight"><img src="../../artwork/logo.png"  alt="finmath.net" width="60"/></a></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2025-10-09<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 6.0.23</li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">finmath lib</li>
    <li><a href="../index.html" title="Introduction"><span class="none"></span>Introduction</a></li>
    <li><a href="../apidocs" title="API Documentation"><span class="none"></span>API Documentation</a></li>
    <li><a href="../gettingstarted.html" title="Getting Started"><span class="none"></span>Getting Started</a></li>
    <li><a href="../building.html" title="Building from Source"><span class="icon-chevron-right"></span>Building from Source</a></li>
    <li><a href="https://github.com/finmath/finmath-lib/releases" class="externalLink" title="Releases"><span class="none"></span>Releases</a></li>
    <li><a href="../releasenotes.html" title="Release Notes"><span class="none"></span>Release Notes</a></li>
    <li><a href="../codingconventions.html" title="Coding Conventions"><span class="none"></span>Coding Conventions</a></li>
   <li class="nav-header">Concepts</li>
    <li><a href="../concepts/stochasticautomaticdifferentiation" title="Stochastic Automatic Differentiation"><span class="none"></span>Stochastic Automatic Differentiation</a></li>
    <li><a href="../concepts/automatictrackingofmeasurability" title="Automatic Tracking of Measurability"><span class="none"></span>Automatic Tracking of Measurability</a></li>
    <li><a href="../concepts/separationofproductandmodel" title="Separation of Product and Model and Numerical Method"><span class="icon-chevron-down"></span>Separation of Product and Model and Numerical Method</a>
     <ul class="nav nav-list">
      <li><a href="../concepts/separationofproductandmodel/modelandproductinterfaces.html" title="Model and Product Interfaces"><span class="none"></span>Model and Product Interfaces</a></li>
      <li><a href="../concepts/separationofproductandmodel/modelandproductdescriptors.html" title="Model and Product Descriptors"><span class="none"></span>Model and Product Descriptors</a></li>
     </ul></li>
   <li class="nav-header">Usages</li>
    <li><a href="../../finmath-experiments" title="Experiments"><span class="none"></span>Experiments</a></li>
    <li><a href="../../finmath-spreadsheets/" title="Spreadsheets"><span class="none"></span>Spreadsheets</a></li>
    <li><a href="../../topics/" title="Special Topics"><span class="none"></span>Special Topics</a></li>
    <li><a href="http://christian-fries.de/finmath/applets/" class="externalLink" title="Applets"><span class="none"></span>Applets</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
<form id="search-form" action="https://www.google.com/search" method="get" >
  <input value="www.finmath.net/finmath-lib" name="sitesearch" type="hidden"/>
  <input class="search-query" name="q" id="query" type="text" />
</form>
<script>asyncJs( 'https://cse.google.com/brand?form=search-form' )</script>
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
    <div id="twitter" style="border:none; margin-top: 10px">
    <a href="https://twitter.com/finmathnet" class="twitter-follow-button" data-show-count="false" data-align="left" data-size="medium" data-show-screen-name="true" data-lang="en">Follow finmathnet</a>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    </div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>Migrating a project referencing finmath-lib from 4.0.x or 4.1.x to 5.0.0 (or higher).</h1><section>
<h2><a name="Java_11"></a>Java 11</h2>
<p>finmath lib 5.0 will move to Java 11 as default. Java 8 is available as a Maven profile (<code>-Pjava8</code>). For some time Java 8 compatible code will be maintained in <code>src/main/java8</code>.</p></section><section>
<h2><a name="Refactorings"></a>Refactorings</h2>
<p>Version 5 of finmath-lib has been refactored in some aspects. An overview can be found in <code>docs/refactoring-4.1.x-to-5.0.0/Refactorings 4.1.x to 5.0.0.xlsx</code>.</p>
<p>If you have a project which runs with version 4.1.3 of finmath lib then you can switch to version 4.1.7. In version 4.1.7 methods that are removed in version 5.0.0 are marked as deprecated with hints on the alternative.</p><section>
<h3><a name="Monte-Carlo_Simulations"></a>Monte-Carlo Simulations</h3><section>
<h4><a name="Model_and_Process"></a>Model and Process</h4>
<p>A process (MonteCarloProcess) needs to know the model (ProcessModel, because the model provides initialValue, drift, factorLoading to the process (Euler scheme), but the model also needed to know the process</p>
<p>Since the numeraire calculation depends on the drift, it is part of the model.</p>
<p>The numeraire is derived from simulated state variables, not in Black-Scholes, but in many other models like Hull-White oder LMM, hence the calculation of the numeraire needs the process.</p></section><section>
<h4><a name="Redesign"></a>Redesign</h4>
<p>In version 4.x this was realized by the model holding a reference to the process.</p>
<p>In version 5.0. the model no longer holds a reference to the process.</p>
<p>Instead, most methods of the model take the process as a first argument (getDrift(process, timeIndex, xxx)).</p>
<p>The model has to be design to be reuseable with different processes. Caches have to check for a change of the process.</p>
<p>So the way to construct a Monte-Carlo simulation of some model is now as follows:</p>

<div>
<div>
<pre class="source">var model = new XxxModel(&#x2026;)

var td = new TimeDiscretizationXxx(&#x2026;.)
var brownianMotion = new BrownianMotionXxx(td,&#x2026;)

var process = new ProcessEurlerScheme(model, brownianMotion)

var simulation = new MonteCarloAssetModel(process)
</pre></div></div>

<p>So, the whole dependency structure is linear.</p>
<p>For another example see this Experiment: <a class="externalLink" href="http://www.finmath.net/finmath-experiments/montecarlo-blackscholes/">http://www.finmath.net/finmath-experiments/montecarlo-blackscholes/</a></p></section><section>
<h4><a name="State_Space_Transform"></a>State Space Transform</h4>
<p>The state space transform is allowed to be time dependent, which allows for more efficient numerical schemes.</p></section></section></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2025
<a href="http://finmath.net">finmath.net</a>
</p>
        </div>
      </div>
    </footer>
  </body>
</html>